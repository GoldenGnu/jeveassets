language: java
os: linux
dist: bionic
env:
  global:
  - secure: "O/+5u1LJIL0iZm53fi9n/+gpjrt26cnapjwkgaMCXJu4DYJn8U/z7bk4bN2uDssH+uj7XYcO/cv/tMxsv68mfiw36w2olU85gsDl9wOB88PNgtGw/wXlpdw+k4uEno8hC+Ue5KA/p+jL9AzkQAeKPIPPruKTgae/C9HdhJgg0rynZYP8fJ5DtQVPOv3reGS+Xq/blB4JbpST4qWvzwQTJPqiPatEEqjcJqyO+6aCJ51fRBF+AXMDQg9lG+ZC+3U9rgwLy5C8pWnuc6/7HFMldHy+bTJo6OwmKbvGtZRd/KlYsagb2b0ldH2Jp+kzAIfgN0/nBMMi3RK1YSz+fqvHVxFAf5WAtOKFr2op8pa/Xd+y1Q7K3NxMOQgZjJMmXGKDh0jOZKY2uxNMylrUJVSfUH3GOq23N6zrvd13vgzNyGTpymzc1jzSIQHcPR4W4aBVwjejra8SayRP2M8F5vEpHufsDFjqlugp/Auw0PyNNw+XjBGCAXbhTY8139OwByVh6IgA6+p+OSAqyixEjaeA8V7Uf8W7HEhR4kpM5TXvQ9bn9OJzzw3jM6mQBri6q/ziZ9/6k32fx71ctOJV0j2gntQaKYxB6GBoFMrMe9zSdSiOwsthM518lDi70zsi4KutCvK9fev6zSrIYcMxtLiwOQyvO6pt1wkp91dZg/lz4Tk="
  - secure: "Mt0c4cTMpgRpA7ifrIRosQA59M5Wqz97d5TSK/Z7gfCEZtqRNs0C+Tm47opB6qCxoUFsKitAz0gToG+tgUf85KDduIbJ4HKWu1W3T9ByQLpRmh+D7l0I3raZ65aa1mexc6AG2cwDl6+MyBwxChmVzUd7bF6VXGsLPNnh1ClZRtUzx7rb/SjwUf0jYYCZ5KMYtXK43LT/Eui83QEgPy7CaZCyWsSZK921lMO2lNzb8cPVGZb9sD1qxBSfS7HRAiGy1TGRgnA4juzlQulzc0Ru5JYkv3v6UpauHSL+iqyEQf93e4RS5/IXlwxtgB8pd17vfKe/dZQlz1imkf7zd5+yr8nJiyK2eUxSB4IMLzWPqHIsIcoBtTSAz2uzyhaX76TvObPpHBz2EU5GWCiLAamfjtzEg2qAMrxLUi6MWTcoZpEL562Ufk/69HUfZ5dSA3GrERZRKcUNa9AjJjxLoLhAN/OhYSPfuuCjdMSNaRbZKZxWOt2hvfL+EIRYtV6v/8bEzsoCzRLrnufBRJW7IrR6YVS6XiJAlCS2Dhi94ydU1ITOtjSx2s6gdUq6EBfAqK4IMl/WOWLxy16nhiiFnUXVVm3ERMm7ts93eRrZcbZAw61hEuXuuNBU0cOlpUBCLMxRw2lJJS/T1owdqKRDSrXrs/aXuVJmJ7RRyAjXzIB9Ap4="
jobs:
  include:
  #JPACKAGE: Linux
  - if: tag IS present
    os: linux
    dist: bionic
    before_script:
    #JPackage JDK
    - wget https://github.com/sormuras/bach/raw/master/install-jdk.sh
    #Download latest JDK 14 EA build - should be changed to JDK 14 stable when it is released
    - source ./install-jdk.sh --feature 14 --os linux-x64
    #Debug
    - echo JAVA_HOME = ${JAVA_HOME}
    - echo PATH = ${PATH}
    - ls ${JAVA_HOME}
    - java -version
    - sudo apt-get -y install fakeroot
    script: mvn -s settings.xml clean deploy -DskipTests -P jpackager-deploy
  #JPACKAGE: Windows
  - if: tag IS present
    os: windows
    language: shell
    before_script:
    #JPackage JDK
    # Download JDK 14.0 General Availability
    - wget -nv -nc -O openjdk-14.zip https://download.java.net/java/GA/jdk14/076bab302c7b4508975440c56f6cc26a/36/GPL/openjdk-14_windows-x64_bin.zip  || true
    - 7z x openjdk-14.zip
    - export JAVA_HOME=$TRAVIS_BUILD_DIR/jdk-14
    - export PATH=$JAVA_HOME/bin:$PATH
    # Maven
    - wget -nv -nc -O maven.zip http://mirrors.dotsrc.org/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.zip  || true
    - 7z x maven.zip
    - export PATH=$TRAVIS_BUILD_DIR/apache-maven-3.6.3/bin:$PATH
    # WiX Toolset
    - wget -nv -nc -O wix311.zip https://github.com/wixtoolset/wix3/releases/download/wix3112rtm/wix311-binaries.zip  || true
    - 7z x wix311.zip -owix311
    - export PATH=$TRAVIS_BUILD_DIR/wix311:$PATH
    #Debug
    - echo JAVA_HOME = ${JAVA_HOME}
    - echo PATH = ${PATH}
    - dir ${JAVA_HOME}
    - java -version
    - mvn --version
    script: mvn install -DskipTests -P jpackager-deploy
    #JPACKAGE: Mac
  - if: tag IS present
    os: osx
    osx_image: xcode11.3
    before_script:
    #JPackage JDK
    - wget https://github.com/sormuras/bach/raw/master/install-jdk.sh
    #Download latest JDK 14 EA build - should be changed to JDK 14 stable when it is released
    - source ./install-jdk.sh --feature 14 --os osx-x64
    #Debug
    - echo JAVA_HOME = ${JAVA_HOME}
    - echo PATH = ${PATH}
    - ls ${JAVA_HOME}
    - java -version
    script: mvn install -DskipTests -P jpackager-deploy
install: true
script: mvn install -P skip-online-tests
cache:
  directories:
  - "$HOME/.m2"
notifications:
  email:
    recipients:
    - nkr@niklaskr.dk
    on_success: never
    on_failure: always
deploy:
  provider: releases
  token:
    secure: hRQqU+s7sHoDkNnN90FkHSYky91o89rdxCpvxyI71cGLDjbo4j0Kicdq1rDsHltECk4bsnNHmv2w4Onc7k6T1s2pqVFNgZ89QOri4umtK1INqQSGu/qsnovdziWOd5CNUO0g987sxjkxuxSHUpY8KfEHh+MvdhVEWkrEU5kYMlCOMbdNqNHznZYWZlWIV6WKS5W6Aeyt+iiHskcIq5LxGjRR16XinP4xb4vlq2Vht4JgTPkqXbvPlAvBXjlovrMFoxImKHb1sAau1UnjMXhwHsJJQ7NbUFe4UXhDNe+MreEf6rjbI62aVsMnAsvgeNWYnO/L2fDMDjrYXZzr/NMWYSNu/RMYc2ndwaPMF6ZwN7ClBa+zlo8CN4DaGnfYuFvAPXFeieAVbmtlbfIW/PDKSndowIMk0hCVOlqlhSFCJZr8M9cMtp4VtMokRUV8hxgQlbEaP49MatqAsg1opI9X41wXqtw822e7ij2Qm2++JF+8d3McWhYXu2BG5miEarHD7x5d1P7ZTpZ0BK2/fMMcfZJdMrh6y9I4VKvawfQO1ylXjQwG/WpH/G+NdyazQB/+kMShX3n/l4xdZJUD+f3aBb1HGsOyCiPUBmH/JpEJA5+xmCiTQZ2c/Orumts81LI7vz80QIrqC/GWIj5tAQnXHXjlrEOO94mh7A8FYU0XeOQ=
  file_glob: true
  file: target/installer/*
  draft: true
  skip_cleanup: true
  tag_name: "$TRAVIS_TAG"
  name: "$TRAVIS_TAG"
  on:
    tags: true
